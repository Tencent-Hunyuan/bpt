<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="Scaling Mesh Generation via Compressive Tokenization">
    <meta name="keywords" content="BPT, GPT, Transformers, Meshes, Generation">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scaling Mesh Generation via Compressive Tokenization</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">

    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
    <link rel="stylesheet" href="./static/css/index.css">

    <style>
		.render_wrapper {
			position: relative;
            height: 300px;
         }
        .render_wrapper_small {
			position: relative;
            height: 200px;
         }
		.render_div {
			position: absolute;
			top: 0;
			left: 0;
		}

        #interpolation-image-wrapper-car{
            text-align: center;
        }
        #interpolation-image-wrapper-chair{
            text-align: center;
        }
        .nested-columns {
            margin-bottom: 0 !important;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="./static/js/index.js"></script>
</head>

<body>

    <section class="hero">
        <div class="hero-body">
            <div class="container is-max-desktop">
                <div class="columns is-centered">
                    <div class="column has-text-centered">
                        <h1 class="title is-1 publication-title">Scaling Mesh Generation via Compressive Tokenization</h1>    
                        <div class="is-size-4 publication-authors">
                            <span class="author-block">
                                <a href="https://whaohan.github.io/">Haohan Weng</a><sup>14</sup>,</span>
                            <span class="author-block">
                                <a href="https://maikouuu.github.io/">Zibo Zhao</a><sup>24</sup>,</span>
                            <span class="author-block">
                                <a href="https://scholar.google.com/citations?user=5d5Y9BoAAAAJ">Biwen Lei</a><sup>4</sup>,</span>
                            <span class="author-block">
                                <a href="https://wi-sc.github.io/xianghui-yang/">Xianghui Yang</a><sup>4</sup>,
                            </span>
                            <span class="author-block">
                                <a href="./index.html">Jian Liu</a><sup>4</sup>,
                            </span>
                            <span class="author-block">
                                <a href="https://zeqiang-lai.github.io/">Zeqiang Lai</a><sup>4</sup>,
                            </span>
                            <span class="author-block">
                                <a href="./index.html">Zhuo Chen</a><sup>4</sup>,
                            </span>
                            <span class="author-block">
                                <a href="./index.html">Yuhong Liu</a><sup>4</sup>,
                            </span>
                            <span class="author-block">
                                <a href="./index.html">Jie Jiang</a><sup>4</sup>,
                            </span>
                            <span class="author-block">
                                <a href="./index.html">Chunchao Guo</a><sup>4</sup>
                            </span>
                            <span class="author-block">
                                <a href="https://sites.scut.edu.cn/cs/2021/0317/c22284a422099/page.psp">Tong Zhang</a><sup>1</sup>
                            </span>
                            <span class="author-block">
                                <a href="https://scholar.google.com.sg/citations?user=fe-1v0MAAAAJ&hl=en">Shenghua Gao</a><sup>3</sup>
                            </span>
                            <span class="author-block">
                                <a href="https://www2.scut.edu.cn/cs/2019/0724/c22284a328910/page.htm">C. L. Philip Chen</a><sup>1</sup>
                            </span>
                        </div>

                        <div class="is-size-5 publication-authors">
                            <span class="author-block"><sup>1</sup>South China University of Technology,</span>
                            <span class="author-block"><sup>2</sup>ShanghaiTech University,</span>
                            <span class="author-block"><sup>3</sup>University of Hong Kong,</span>
                            <span class="author-block"><sup>4</sup>Tencent Hunyuan</span>
                        </div>

                        <div class="column has-text-centered">
                            <div class="publication-links">
                                <span class="link-block">
                                    <a class="external-link button is-normal is-rounded is-dark" href="./index.html">
                                        <span class="icon">
                                            <i class="ai ai-arxiv"></i>
                                        </span>
                                        <span>arXiv</span>
                                    </a>
                                </span>
                                <!-- Github Link. -->
                                <span class="link-block">
                                    <a href="https://github.com/whaohan/bpt" class="external-link button is-normal is-rounded is-dark">
                                        <span class="icon">
                                            <i class="fab fa-github"></i>
                                        </span>
                                        <span>Code</span>
                                    </a>
                                </span>
                                <span class="link-block">
                                    <a href="./index.html" class="external-link button is-normal is-rounded is-dark">
                                        <span class="icon">
                                            <svg class="svg-inline--fa fa-database fa-w-14" aria-hidden="true" focusable="false" data-prefix="fa" data-icon="database" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"></path></svg>
                                          </span>
                                        <span>Checkpoint</span>
                                    </a>
                                </span>
                                <!-- Dataset Link. -->
                                <span class="link-block"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="hero is-light is-small">
        <div class="hero-body">
            <h3 class="is-size-4 title has-text-centered"> Point-cloud Conditioned Mesh Generation </h3>
            <div class="container">
                <div id="results-carousel" class=" carousel results-carousel ">
                    <div class=" item item-steve render_wrapper">
                        <div id="pc_002" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="pc_cond_002" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
                        <div id="pc_003" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="pc_cond_003" class="render_div"></div>
                    </div>
                </div>
                <div id="results-carousel" class=" carousel results-carousel ">
                    <div class=" item item-steve render_wrapper">
                        <div id="pc_005" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="pc_cond_005" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
                        <div id="pc_008" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="pc_cond_008" class="render_div"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="hero is-light is-small">
        <div class="hero-body">
            <h3 class="is-size-4 title has-text-centered"> Image Conditioned Mesh Generation </h3>
            <div class="container">
                <div id="results-carousel" class=" carousel results-carousel ">
                    <div class=" item item-steve render_wrapper">
                        <img src="./models/images/009.png" style="display: flex; margin: auto; width: 90%">
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="images_001" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
                        <img src="./models/images/002.png" style="display: flex; margin: auto; width: 90%">
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="images_002" class="render_div"></div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div id="results-carousel" class="carousel results-carousel">
                    <div class=" item item-steve render_wrapper">
			            <img src="./models/images/003.png" style="display: flex; margin: auto; width: 90%">
                    </div>
                    <div class="item item-steve render_wrapper">
			            <div id="images_003" class="render_div"></div>
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <img src="./models/images/011.png" style="display: flex; margin: auto; width: 90%">
                    </div>
                    <div class=" item item-steve render_wrapper">
			            <div id="images_004" class="render_div"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container is-max-desktop">
            <!-- Abstract. -->
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <h2 class="title is-3">Abstract</h2>
                    <div class="content has-text-justified">
                        <p>
                            We propose a compressive yet effective mesh representation, <span class="dnerf">Blocked and Patchified Tokenization (BPT)</span>, facilitating the generation of meshes exceeding 8k faces. 
                            BPT compresses mesh sequences by employing block-wise indexing and patch aggregation, reducing their length by approximately 75\% compared to the original sequences. 
                            This compression milestone unlocks the potential to utilize mesh data with significantly more faces, thereby enhancing detail richness and improving generation robustness.
                            Empowered with the BPT, we have built a foundation mesh generative model training on scaled mesh data to support flexible control for point clouds and images. 
                            Our model demonstrates the capability to generate meshes with intricate details and accurate topology, achieving SoTA performance on mesh generation and reaching the level for direct product usage.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="section">
        <div class="container is-max-desktop">
            <h2 class="title is-4">Tokenization</h2>
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <div class="content has-text-justified">
                        <img src="./static/images/BPT.png"/>
                        <p>
                            <b>The proposed Blocked and Patchified Tokenization (BPT).</b>
                            (a) We convert the coordinates from the Cartesian system to block-wise indexes. The coordinates are first separated equally into several blocks. Then vertices inside each block are located with 1-dim indexes. 
                            (b) The nearby faces are aggregated as patches to compress the mesh sequence. Each patch center is set as the vertex connected with the most unvisited faces. Subsequently, other vertices within the patch are included in the subsequence to create a complete patch.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="section">
        <div class="container is-max-desktop">
            <h2 class="title is-4">Scaling on Mesh Data</h2>
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <div class="content has-text-justified">
                        <img src="./static/images/scaling.png"/>
                        <p>
                            <b>Scaling data for mesh generation with BPT.</b>
                            (a) Existing models can only handle meshes with at most 4k faces, which still lack intricate details. Empowered by BPT, our model can leverage meshes exceeding 8k faces, effectively extending the training scope for mesh generation.
                            (b) We train the same model on meshes with different maximum numbers of faces. As the number of mesh faces increases, the performance of mesh generation significantly improves, highlighting the value of high-poly training data. The generation performance is measured by the Hausdorff distance between the input point cloud and generated meshes (lower is better).  
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- <section class="section" id="BibTeX">
        <div class="container is-max-desktop content">
            <h2 class="title is-4">BibTeX</h2>
            <pre>
                <code>@article{
}</code>
            </pre>
        </div>
    </section> -->


    <footer class="footer">
        <div class="container">
            <div class="content has-text-centered">
                <a class="icon-link" href="https://github.com/whaohan" class="external-link">
                    <i class="fab fa-github"></i>
                </a>
            </div>
            <div class="columns is-centered">
                <div class="column is-8">
                    <div class="content">
                        <p style="text-align:center">
                            Source code mainly borrowed from <a href="https://keunhong.com/">Keunhong Park</a>'s <a
                                href="https://nerfies.github.io/">Nerfies website</a>.
                        </p>
                        <p style="text-align:center">
                            Please contact <a href="https://whaohan.github.io/">Yawar Siddiqui</a> for feedback and questions.
                        </p>

                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "./js/three.module.js"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';

    import { PLYLoader } from './js/PLYLoader.js';
    import { OrbitControls } from './js/OrbitControls.js'

    let div_to_scene = {};

    let items = [
        "001",
        "002",
        "003",
        "004",
        "005",
        "006",
        "007",
        "008",
    ]

    for (let item of items) {
        let key = `images_${item}`;
        div_to_scene[key] = { geo: null, color: null };
        key = `pc_cond_${item}`;
        div_to_scene[key] = { geo: null, color: null };
        key = `pc_${item}`;
        div_to_scene[key] = { geo: null, color: null };
    }


    let div_to_render_scene = {
        "mesh_style_0": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
        "mesh_style_1": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
        "mesh_style_2": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
        "mesh_style_3": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
    }
    let mouse_button_down = false;
    let list_of_orbit_controls = []
    let style_camera = null;
    let render_colors = true;
    let style_id = "0"

    function setup_camera(div_name){
        console.log(div_name)
        let container = document.getElementById(div_name);
        let width = container.parentElement.clientWidth;
        let height = container.parentElement.clientHeight;
        let camera = new THREE.PerspectiveCamera( 55, width / height, 0.1, 50 );

        // let camera_init_position = new THREE.Vector3( 2.25, 1.525, -3.75 );
        let camera_init_position = new THREE.Vector3( 2.25, 1.525, 3.75 );
        camera_init_position = camera_init_position.multiplyScalar(0.55)
        camera.position.set(camera_init_position.x, camera_init_position.y, camera_init_position.z);
        return camera;
    }

    function setup_render_divs(div_name, mesh_path){
        let camera = setup_camera(div_name)
        let orbit_control = create_render_div(camera, div_name, mesh_path)
        list_of_orbit_controls.push(orbit_control)
    }

    function setup_render_divs_pc(div_name, mesh_path){
        let camera = setup_camera(div_name)
        let orbit_control = create_point_cloud_div(camera, div_name, mesh_path)
        list_of_orbit_controls.push(orbit_control)
    }

    function create_point_cloud_div(camera, div_id, point_cloud_path) {
        let container;
        let renderer, controls;
    
        init();
        animate();
    
        function init() {
            container = document.getElementById(div_id);
            let width = container.parentElement.clientWidth;
            let height = container.parentElement.clientHeight;
    
            div_to_scene[div_id]["color"] = new THREE.Scene();
            div_to_scene[div_id]["geo"] = new THREE.Scene();
            div_to_scene[div_id]["color"].background = new THREE.Color( 0xffffff );
            div_to_scene[div_id]["geo"].background = new THREE.Color( 0xffffff );

            // PLY file
            const loader = new PLYLoader();
            loader.load( point_cloud_path, function ( geometry ) {

                // 创建点云材质
                const material = new THREE.PointsMaterial({ color: 0x888888, size: 0.05 });

                // 创建点云对象并设置几何体和材质
                const points = new THREE.Points(geometry, material);
                const points2 = new THREE.Points(geometry, material);

                div_to_scene[div_id]["geo"].add( points );
                div_to_scene[div_id]["color"].add( points2 );

            }, (xhr) => {
                console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
            }, (error) => {
                console.log('load fail')
                console.log(error)
            }
            );
    
            div_to_scene[div_id]["color"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
            div_to_scene[div_id]["geo"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
            addShadowedLight(div_to_scene[div_id]["color"], 1, 1, 1, 0xffffff, 1.35 / 2 );
            addShadowedLight(div_to_scene[div_id]["color"],  0.5, 1, - 1, 0xffffff, 1 / 2 );
            addShadowedLight(div_to_scene[div_id]["geo"], 1, 1, 1, 0xffffff, 1.35 );
            addShadowedLight(div_to_scene[div_id]["geo"],  0.5, 1, - 1, 0xffffff, 1 );
    
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(width, height);
            renderer.outputEncoding = THREE.sRGBEncoding;
    
            renderer.shadowMap.enabled = true;
    
            container.appendChild(renderer.domElement);
    
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = false;
    
            // Resize
            window.addEventListener('resize', onWindowResize);
        }
    
        function onWindowResize() {
            let width = container.clientWidth;
            let height = container.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize( width, height );
        }
        function animate() {
            requestAnimationFrame( animate );
            render();
        }

        function render() {
            renderer.render( div_to_scene[div_id][render_colors ? "color" : "geo"], camera );
            controls.update();
        }

        return controls;
    }


    function create_render_div(camera, div_id, mesh_path) {
        let container;
        let renderer, controls;

        init();
        animate();

        function init() {

            container = document.getElementById(div_id);
            let width = container.parentElement.clientWidth;
            let height = container.parentElement.clientHeight;

            div_to_scene[div_id]["color"] = new THREE.Scene();
            div_to_scene[div_id]["geo"] = new THREE.Scene();
            div_to_scene[div_id]["color"].background = new THREE.Color( 0xffffff );
            div_to_scene[div_id]["geo"].background = new THREE.Color( 0xffffff );

            // PLY file
            // console.log(mesh_path)
            const loader = new PLYLoader();
            loader.load( mesh_path, function ( geometry ) {

                geometry.computeVertexNormals();
                let material_color = new THREE.MeshStandardMaterial( { color: 0x4169E1, flatShading: true, side: THREE.DoubleSide } )
                let material_geo = new THREE.MeshStandardMaterial( { color: 0x2e4e8c, flatShading: true, side: THREE.DoubleSide } )

                let wireframe = new THREE.WireframeGeometry( geometry );
                let line = new THREE.LineSegments( wireframe );
                line.material.color.setHex(0xffffff);

                const mesh_color = new THREE.Mesh( geometry, material_color );
                const mesh_geo = new THREE.Mesh( geometry, material_geo );

                div_to_scene[div_id]["color"].add( mesh_color );
                div_to_scene[div_id]["color"].add(line);
                div_to_scene[div_id]["geo"].add( mesh_geo );

            }, (xhr) => {
                console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
            }, (error) => {
                console.log('load fail')
                console.log(error)
            }
            );

            // lights

            div_to_scene[div_id]["color"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
            div_to_scene[div_id]["geo"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
            addShadowedLight(div_to_scene[div_id]["color"], 1, 1, 1, 0xffffff, 1.35 / 2 );
            addShadowedLight(div_to_scene[div_id]["color"],  0.5, 1, - 1, 0xffffff, 1 / 2 );
            addShadowedLight(div_to_scene[div_id]["geo"], 1, 1, 1, 0xffffff, 1.35 );
            addShadowedLight(div_to_scene[div_id]["geo"],  0.5, 1, - 1, 0xffffff, 1 );

            // renderer

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( width, height);
            renderer.outputEncoding = THREE.sRGBEncoding;

            renderer.shadowMap.enabled = true;

            container.appendChild( renderer.domElement );

            controls = new OrbitControls(camera, renderer.domElement)
            controls.enableDamping = false

            // resize

            window.addEventListener( 'resize', onWindowResize );

    }
        function onWindowResize() {
            let width = container.clientWidth;
            let height = container.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize( width, height );
        }
        function animate() {
            requestAnimationFrame( animate );
            render();
        }

        function render() {
            renderer.render( div_to_scene[div_id][render_colors ? "color" : "geo"], camera );
            controls.update();
        }

        return controls;
    }


    function addShadowedLight(scene, x, y, z, color, intensity ) {

        const directionalLight = new THREE.DirectionalLight( color, intensity );
        directionalLight.position.set( x, y, z );
        scene.add( directionalLight );

        directionalLight.castShadow = true;

        const d = 1;
        directionalLight.shadow.camera.left = - d;
        directionalLight.shadow.camera.right = d;
        directionalLight.shadow.camera.top = d;
        directionalLight.shadow.camera.bottom = - d;

        directionalLight.shadow.camera.near = 1;
        directionalLight.shadow.camera.far = 4;

        directionalLight.shadow.mapSize.width = 1024;
        directionalLight.shadow.mapSize.height = 1024;

        directionalLight.shadow.bias = - 0.001;

    }

    document.addEventListener('keydown', logKey);

    function logKey(evt) {
        if (evt.keyCode === 71 && !mouse_button_down) {
            switch_geometry()
        }
        if (evt.keyCode === 82 && !mouse_button_down) {
            list_of_orbit_controls.forEach(oc => {
                console.log(oc.object.position)
            })
            reset_orbit_controls()
        }
    }

    function switch_geometry() {
        render_colors = !render_colors
    }

    function reset_orbit_controls() {
        list_of_orbit_controls.forEach(oc => {
            oc.reset()
        })
    }

    function set_style_0(){
        style_id = "0"
    }

    function set_style_1(){
        style_id = "1"
    }

    function set_style_2(){
        style_id = "2"
    }

    document.body.onmousedown = function(evt) {
        if (evt.button === 0)
            mouse_button_down = true
    }
    document.body.onmouseup = function(evt) {
        if (evt.button === 0)
            mouse_button_down = false
    }

    window.onload = function() {
        let slider = document.getElementsByClassName("slider")[0]
        slider.removeAttribute("tabIndex")
        
        setup_render_divs_pc('pc_002', 'models/pc/002.ply')
        setup_render_divs_pc('pc_003', 'models/pc/007.ply')
        setup_render_divs_pc('pc_005', 'models/pc/010.ply')
        setup_render_divs_pc('pc_008', 'models/pc/011.ply')

        setup_render_divs('pc_cond_002', 'models/pc_cond_ply/009.ply')
        setup_render_divs('pc_cond_003', 'models/pc_cond_ply/007.ply')
        setup_render_divs('pc_cond_005', 'models/pc_cond_ply/010.ply')
        setup_render_divs('pc_cond_008', 'models/pc_cond_ply/011.ply')

        setup_render_divs('images_001', 'models/images_cond/009.ply')
        setup_render_divs('images_002', './models/images_cond/002.ply')
        setup_render_divs('images_003', 'models/images_cond/003.ply')
        setup_render_divs('images_004', './models/images_cond/011.ply')
    };

    </script>

</body>

</html>
